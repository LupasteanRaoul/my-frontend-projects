<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Advanced Tic-Tac-Toe | Raoul Lupastean</title>
    <meta name="description" content="Advanced Tic-Tac-Toe Game with AI, Multiplayer, and Achievements - by Raoul Lupastean">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>
    <!-- Name Entry Modal (Mandatory) -->
    <div class="modal-overlay" id="nameEntryModal" style="display: flex;">
        <div class="modal-content name-entry-modal">
            <div class="modal-icon">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="modal-title">Welcome!</h2>
            <p class="modal-message">Please enter your name to continue</p>
            <div class="name-entry-input">
                <input type="text" id="initialNameInput" placeholder="Enter your name..." maxlength="15" data-testid="initial-name-input">
                <p class="name-error" id="nameError" style="display: none;">Name is required!</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn accept" onclick="submitInitialName()" data-testid="submit-name-btn">
                    <i class="fas fa-play"></i> Start Playing
                </button>
            </div>
        </div>
    </div>

    <div class="game-wrapper" id="app" style="display: none;">
        <div class="game-container">
            <!-- Header -->
            <header class="header">
                <h1 class="title">
                    <i class="fas fa-gamepad title-icon"></i>
                    <span>Advanced Tic-Tac-Toe</span>
                </h1>
                <p class="subtitle">Play against AI or with a friend</p>
                <p class="welcome-user">Welcome, <span id="currentUserName"></span>!</p>
            </header>

            <!-- Mode Selector -->
            <div class="mode-selector">
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="ai" onclick="changeGameMode('ai')" data-testid="mode-ai-btn">
                        <i class="fas fa-robot"></i> VS AI
                    </button>
                    <button class="mode-btn" data-mode="local" onclick="changeGameMode('local')" data-testid="mode-local-btn">
                        <i class="fas fa-users"></i> 2 Players Local
                    </button>
                    <button class="mode-btn" data-mode="online" onclick="changeGameMode('online')" data-testid="mode-online-btn">
                        <i class="fas fa-globe"></i> Online Multiplayer
                    </button>
                </div>

                <!-- Local Player O Name (only for local mode) -->
                <div class="player-o-setup" id="playerOSetup" style="display: none;">
                    <div class="name-input-group">
                        <label><span class="o-color">O</span> Player Name</label>
                        <input type="text" id="playerOName" placeholder="Enter Player O name..." maxlength="15" value="">
                    </div>
                </div>

                <!-- Online Controls -->
                <div class="online-controls" id="onlineControls" style="display: none;">
                    <div class="room-controls" id="roomControls">
                        <button class="room-btn" onclick="createRoom()" data-testid="create-room-btn">
                            <i class="fas fa-plus"></i> Create Room
                        </button>
                        <div class="join-room">
                            <input type="text" id="roomInput" placeholder="Enter room code" maxlength="6" data-testid="room-input">
                            <button class="room-btn" onclick="joinRoom()" data-testid="join-room-btn">
                                <i class="fas fa-sign-in-alt"></i> Join
                            </button>
                        </div>
                    </div>
                    <div class="room-info" id="roomInfo" style="display: none;">
                        <p>
                            Room Code: 
                            <span class="room-code" id="roomCodeDisplay"></span>
                            <button class="copy-btn" onclick="copyRoomCode()" id="copyBtn" data-testid="copy-room-btn">
                                <i class="fas fa-copy"></i>
                            </button>
                        </p>
                        <p class="room-status">Status: <span id="roomStatus">Waiting...</span></p>
                        <p class="player-info">You are: <span id="playerSymbolDisplay" class="x-color">X</span></p>
                        <p class="opponent-info" id="opponentInfo" style="display: none;">Opponent: <span id="opponentName"></span></p>
                        <button class="room-btn leave-btn" onclick="leaveRoom()" data-testid="leave-room-btn">
                            <i class="fas fa-sign-out-alt"></i> Leave Room
                        </button>
                    </div>
                </div>
            </div>

            <!-- Game Status -->
            <div class="game-status">
                <div class="status-row">
                    <span>Mode: <strong class="highlight" id="modeDisplay">VS AI</strong></span>
                    <span>Turn: <strong id="turnDisplay" class="x-color">X</strong></span>
                </div>
                <div class="timer-display" id="timerDisplay" style="display: none;">
                    <i class="fas fa-clock"></i> <span id="timerValue">30</span>s
                </div>
                <p class="status-message" id="statusMessage">Your Turn (X)</p>
            </div>

            <!-- AI Controls -->
            <div class="ai-controls-wrapper" id="aiControls">
                <div class="ai-controls-inner">
                    <label><i class="fas fa-robot"></i> AI Difficulty</label>
                    <div class="difficulty-buttons">
                        <button class="diff-btn" data-diff="easy" onclick="setAiDifficulty('easy')" data-testid="diff-easy-btn">üòä Easy</button>
                        <button class="diff-btn active" data-diff="medium" onclick="setAiDifficulty('medium')" data-testid="diff-medium-btn">üéì Medium</button>
                        <button class="diff-btn" data-diff="hard" onclick="setAiDifficulty('hard')" data-testid="diff-hard-btn">üëë Hard</button>
                    </div>
                </div>
            </div>

            <!-- Game Board -->
            <div class="board-container">
                <div class="board" id="board" data-testid="game-board"></div>
            </div>

            <!-- Scoreboard -->
            <div class="scoreboard-container">
                <div class="scoreboard">
                    <div class="score-grid">
                        <div class="score-item x-score">
                            <span class="score-label x-color" id="scoreXLabel">X Wins</span>
                            <span class="score-value" id="scoreX">0</span>
                        </div>
                        <div class="score-item draw-score">
                            <span class="score-label draw-color">Draws</span>
                            <span class="score-value" id="scoreDraw">0</span>
                        </div>
                        <div class="score-item o-score">
                            <span class="score-label o-color" id="scoreOLabel">O Wins</span>
                            <span class="score-value" id="scoreO">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn primary" onclick="resetGame()" data-testid="new-game-btn">
                    <i class="fas fa-redo"></i> New Game
                </button>
                <button class="action-btn secondary" onclick="resetScores()" data-testid="reset-score-btn">
                    <i class="fas fa-trash"></i> Reset Score
                </button>
                <button class="action-btn icon-btn active" id="soundBtn" onclick="toggleSound()" data-testid="sound-btn">
                    <i class="fas fa-volume-up" id="soundIcon"></i>
                </button>
                <button class="action-btn icon-btn" id="timerBtn" onclick="toggleTimer()" data-testid="timer-btn">
                    <i class="fas fa-stopwatch"></i>
                </button>
            </div>

            <!-- Leaderboard Section -->
            <div class="section-toggle">
                <button class="toggle-btn" onclick="toggleLeaderboard()" data-testid="leaderboard-toggle-btn">
                    <i class="fas fa-ranking-star"></i>
                    Global Leaderboard
                    <i class="fas fa-chevron-down" id="leaderboardChevron"></i>
                </button>
                <div class="leaderboard-container" id="leaderboardContainer" style="display: none;">
                    <div class="leaderboard-tabs">
                        <button class="leaderboard-tab active" onclick="switchLeaderboardTab('wins')" data-tab="wins">
                            <i class="fas fa-trophy"></i> Most Wins
                        </button>
                        <button class="leaderboard-tab" onclick="switchLeaderboardTab('streak')" data-tab="streak">
                            <i class="fas fa-fire"></i> Best Streak
                        </button>
                    </div>
                    <div class="leaderboard-content" id="leaderboardWins">
                        <div class="leaderboard-list" id="winsLeaderboard"></div>
                    </div>
                    <div class="leaderboard-content" id="leaderboardStreak" style="display: none;">
                        <div class="leaderboard-list" id="streakLeaderboard"></div>
                    </div>
                </div>
            </div>

            <!-- Achievements Section -->
            <div class="section-toggle">
                <button class="toggle-btn" onclick="toggleAchievements()" data-testid="achievements-toggle-btn">
                    <i class="fas fa-trophy"></i>
                    Achievements (<span id="achievementCount">0</span>/12)
                    <i class="fas fa-chevron-down" id="achievementChevron"></i>
                </button>
                <div class="achievements-grid" id="achievementsGrid" style="display: none;"></div>
            </div>

            <!-- History Section -->
            <div class="section-toggle">
                <button class="toggle-btn" onclick="toggleHistory()" data-testid="history-toggle-btn">
                    <i class="fas fa-history"></i>
                    Game History (<span id="historyCount">0</span> games)
                    <i class="fas fa-chevron-down" id="historyChevron"></i>
                </button>
                <div class="history-list" id="historyList" style="display: none;"></div>
            </div>

            <!-- Stats Display -->
            <div class="stats-display">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="statGames">0</span>
                        <span class="stat-label">Games Played</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statWins">0</span>
                        <span class="stat-label">Total Wins</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statBestStreak">0</span>
                        <span class="stat-label">Best Streak</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statCurrentStreak">0</span>
                        <span class="stat-label">Current Streak</span>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> How to Play</h3>
                <ul>
                    <li>Players take turns placing X and O on a 3x3 grid</li>
                    <li>First to get 3 in a row (horizontally, vertically, or diagonally) wins</li>
                    <li>In AI mode, you play as X and AI plays as O</li>
                    <li>For online play, share your room code with a friend!</li>
                    <li>Unlock achievements by winning games and completing challenges</li>
                </ul>
            </div>

            <!-- Footer -->
            <footer class="footer">
                <p>Made with ‚ù§Ô∏è by Raoul Lupastean</p>
                <p>
                    <a href="https://github.com/LupasteanRaoul" target="_blank">
                        <i class="fab fa-github"></i> GitHub Profile
                    </a>
                    |
                    <a href="https://lupasteanraoul.github.io" target="_blank">
                        <i class="fas fa-external-link-alt"></i> View Portfolio
                    </a>
                </p>
            </footer>
        </div>

        <!-- Achievement Toast -->
        <div class="achievement-toast" id="achievementToast" style="display: none;">
            <div class="achievement-toast-icon" id="toastIcon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="achievement-toast-content">
                <span class="achievement-toast-title">Achievement Unlocked!</span>
                <span class="achievement-toast-name" id="toastName"></span>
            </div>
        </div>

        <!-- Rematch Modal (for receiving rematch request) -->
        <div class="modal-overlay" id="rematchModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-icon">
                    <i class="fas fa-redo"></i>
                </div>
                <h2 class="modal-title">Rematch Request</h2>
                <p class="modal-message" id="rematchMessage">The other player wants a rematch!</p>
                <p class="modal-submessage">Do you want to play again?</p>
                <div class="modal-buttons">
                    <button class="modal-btn accept" onclick="acceptRematch()" data-testid="accept-rematch-btn">
                        <i class="fas fa-check"></i> Yes
                    </button>
                    <button class="modal-btn decline" onclick="declineRematch()" data-testid="decline-rematch-btn">
                        <i class="fas fa-times"></i> No
                    </button>
                </div>
            </div>
        </div>

        <!-- Waiting for Rematch Response Modal -->
        <div class="modal-overlay" id="waitingRematchModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-icon spinning">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <h2 class="modal-title">Waiting for Response</h2>
                <p class="modal-message">Waiting for the other player to respond...</p>
                <div class="modal-buttons">
                    <button class="modal-btn decline" onclick="cancelRematchRequest()" data-testid="cancel-rematch-btn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Rematch Declined Modal -->
        <div class="modal-overlay" id="rematchDeclinedModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-icon declined">
                    <i class="fas fa-times"></i>
                </div>
                <h2 class="modal-title">Rematch Declined</h2>
                <p class="modal-message" id="declinedMessage">The other player declined the rematch.</p>
                <div class="modal-buttons">
                    <button class="modal-btn accept" onclick="closeDeclinedModal()" data-testid="close-declined-btn">
                        <i class="fas fa-check"></i> OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
